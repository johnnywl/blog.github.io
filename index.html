<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Johnny&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Johnny&#39;s Blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Johnny&#39;s Blog">
  <link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Johnny's Blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Johnny's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/CentOS配置YUM源/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Johnny's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/24/CentOS配置YUM源/" class="post-title-link" itemprop="url">CentOS配置YUM源</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-24 17:49:54 / 修改时间：17:50:36" itemprop="dateCreated datePublished" datetime="2019-09-24T17:49:54+08:00">2019-09-24</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CentOS配置外部YUM源"><a href="#CentOS配置外部YUM源" class="headerlink" title="CentOS配置外部YUM源"></a>CentOS配置外部YUM源</h1><p>以配置阿里云的为例</p>
<ul>
<li>备份</li>
</ul>
<p><code>mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</code></p>
<p><img src="e:%5Cit%5C%E9%85%8D%E7%BD%AE%E5%A4%96%E9%83%A8%E6%BA%90%5C1.png" alt></p>
<p><img src="e:%5Cit%5C%E9%85%8D%E7%BD%AE%E5%A4%96%E9%83%A8%E6%BA%90%5C2.png" alt></p>
<ul>
<li>下载新的CentOS-Base.repo 到/etc/yum.repos.d/  #Centos6 yum源</li>
</ul>
<p><code>wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</code></p>
<p><img src="e:%5Cit%5C%E9%85%8D%E7%BD%AE%E5%A4%96%E9%83%A8%E6%BA%90%5C3.png" alt></p>
<ul>
<li><p>下载新的CentOS-Base.repo 到/etc/yum.repos.d/  #Centos7 yum源</p>
<figure class="highlight plain"><figcaption><span>-O</span><a href="/etc/yum.repos.d/CentOS-Base.repo">http://mirrors.aliyun.com/repo/Centos-7.repo```      #阿里云源</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ```wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.163.com/.help/CentOS7-Base-163.repo```   #163源</span><br><span class="line"></span><br><span class="line">* 清除系统所有的yum缓存</span><br><span class="line"></span><br><span class="line">  ```yum clean all</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成yum缓存</p>
<figure class="highlight plain"><figcaption><span>makecache```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![](e:\it\配置外部源\4.png)</span><br><span class="line">![](e:\it\配置外部源\5.png)</span><br><span class="line"></span><br><span class="line"># CentOS配置外部epel源</span><br><span class="line"></span><br><span class="line">* 安装epel源</span><br></pre></td></tr></table></figure>

<p>yum list | grep epel-release<br>yum install -y epel-release<br>cd /etc/yum.repos.d/<br>ls   # epel源安装成功，比原来多了一个epel.repo和epel-testing.repo文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ### 使用阿里开源镜像提供的epel源</span><br><span class="line"></span><br><span class="line">```wget -O /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="清除系统yum缓存，并重新生成新的yum缓存"><a href="#清除系统yum缓存，并重新生成新的yum缓存" class="headerlink" title="清除系统yum缓存，并重新生成新的yum缓存"></a>清除系统yum缓存，并重新生成新的yum缓存</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="查看系统可用的yum源和所有的yum源"><a href="#查看系统可用的yum源和所有的yum源" class="headerlink" title="查看系统可用的yum源和所有的yum源"></a>查看系统可用的yum源和所有的yum源</h3><p><code>yum repolist enabled</code></p>
</li>
</ul>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/seafile部署onlyoffice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Johnny's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/24/seafile部署onlyoffice/" class="post-title-link" itemprop="url">seafile部署onlyoffice</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-24 17:45:34 / 修改时间：17:46:16" itemprop="dateCreated datePublished" datetime="2019-09-24T17:45:34+08:00">2019-09-24</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="为seafile部署onlyoffice"><a href="#为seafile部署onlyoffice" class="headerlink" title="为seafile部署onlyoffice"></a>为seafile部署onlyoffice</h1><ul>
<li><p>准备工作</p>
<ul>
<li>成功安装seafie </li>
<li>成功安装onlyoffice</li>
</ul>
</li>
<li><p>配置seafile </p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">编辑 seahub_settings.py 加入下方配置</span><br><span class="line"># Enable Only Office</span><br><span class="line">ENABLE_ONLYOFFICE = True</span><br><span class="line">VERIFY_ONLYOFFICE_CERTIFICATE = False</span><br><span class="line">ONLYOFFICE_APIJS_URL = &apos;http://172.16.76.13:8001/web-apps/apps/api/documents/api.js&apos;</span><br><span class="line">ONLYOFFICE_FILE_EXTENSION = (&apos;doc&apos;, &apos;docx&apos;, &apos;ppt&apos;, &apos;pptx&apos;, &apos;xls&apos;, &apos;xlsx&apos;)</span><br><span class="line">ONLYOFFICE_EDIT_FILE_EXTENSION = (&apos;doc&apos;, &apos;docx&apos;, &apos;ppt&apos;, &apos;pptx&apos;, &apos;xls&apos;, &apos;xlsx&apos;)</span><br></pre></td></tr></table></figure>

<p><strong>注1：其中 VERIFY_ONLYOFFICE_CERTIFICATE 选项如果 onlyoffice 使用了 https 的话可以选择更改为 True 提高安全性，如果是使用 http 协议则改为 False</strong></p>
<p><strong>注2：如果没使用 memcached 的话，还需要执行 rm /tmp/seahub_cached/ 清空缓存</strong></p>
<ul>
<li>重启seahub</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -f /opt/seafile/conf/seahub_settings.pyc</span><br><span class="line">cd /opt/seafile/seafile-server-latest</span><br><span class="line">./seahub.sh restart</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/CentOS之SSH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Johnny's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/24/CentOS之SSH/" class="post-title-link" itemprop="url">CentOS之SSH</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-24 17:44:16 / 修改时间：17:44:32" itemprop="dateCreated datePublished" datetime="2019-09-24T17:44:16+08:00">2019-09-24</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CentOS解决SSH登录速度慢"><a href="#CentOS解决SSH登录速度慢" class="headerlink" title="CentOS解决SSH登录速度慢"></a>CentOS解决SSH登录速度慢</h1><ul>
<li><p>备份配置文件</p>
<figure class="highlight plain"><figcaption><span>/etc/ssh/sshd_config</span><a href="/etc/ssh/sshd_config.bak```">link</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+ 修改配置文件</span><br></pre></td></tr></table></figure>

<p>vi /etc/ssh/sshd_config</p>
<h1 id="修改以下2个参数"><a href="#修改以下2个参数" class="headerlink" title="修改以下2个参数"></a>修改以下2个参数</h1><p>输入/,查找GSSAPIAuthentication 赋值为no<br>输入/,查找UseDNS,赋值为 no(该项默认不启用的，要把前面的#删除掉)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+ 重启ssh服务</span><br></pre></td></tr></table></figure>

<h1 id="CentOS7-重启服务命令"><a href="#CentOS7-重启服务命令" class="headerlink" title="CentOS7 重启服务命令"></a>CentOS7 重启服务命令</h1><p>systemctl restart sshd</p>
<h1 id="CentOS6-重启服务命令"><a href="#CentOS6-重启服务命令" class="headerlink" title="CentOS6 重启服务命令"></a>CentOS6 重启服务命令</h1><p>service sshd restart</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">## SSH 密钥创建及密钥登录</span><br><span class="line"></span><br><span class="line">* 创建密钥对</span><br></pre></td></tr></table></figure>

<p>cd /用户目录/.ssh<br>ssh-keygen -t rsa</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ***执行密钥生成命令，基本上是一路回车既可以了，但是需要注意的是：执行命令的过程中是会提示输入密钥的密码的，不需要密码直接回车就行。密钥生成后会在当前目录下多出两个文件，id_rsa和id_rsa.pub，其中id_rsa是私钥，id_rsa.pub这个是公钥。***</span><br><span class="line"></span><br><span class="line">* 公钥添加到需要登录的远程服务器的authorized_keys文件</span><br><span class="line"></span><br><span class="line">  - 方法一：</span><br></pre></td></tr></table></figure>

<p>ssh-copy-id -i /root/.ssh/id_rsa.pub root@远程服务器IP地址或域名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 方法二：</span><br><span class="line"></span><br><span class="line">复制id_rsa.pub文件的内容</span><br></pre></td></tr></table></figure>

<p>vi /root/.ssh/id_rsa.pub</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">进入远程服务器需要SSH登录的用户的目录下，查看目录下是否有authorized_keys文件没有的话创建下,授予600权限，将复制的id_rsa.pub文件内容进行粘贴到authorized_keys文件中</span><br></pre></td></tr></table></figure>

<p>cd /root/.ssh<br>ls<br>vi authorized_keys<br>chmod 600 /root/.ssh/authorized_keys  # 此文件的权限必须是600</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*  重启ssh服务</span><br></pre></td></tr></table></figure>

<h1 id="CentOS7-重启服务命令-1"><a href="#CentOS7-重启服务命令-1" class="headerlink" title="CentOS7 重启服务命令"></a>CentOS7 重启服务命令</h1><p>systemctl restart sshd</p>
<h1 id="CentOS6-重启服务命令-1"><a href="#CentOS6-重启服务命令-1" class="headerlink" title="CentOS6 重启服务命令"></a>CentOS6 重启服务命令</h1><p>service sshd restart</p>
<pre><code>


</code></pre></li>
</ul>
<h2 id="ssh目录找不到解决方法"><a href="#ssh目录找不到解决方法" class="headerlink" title="~/.ssh目录找不到解决方法"></a>~/.ssh目录找不到解决方法</h2><p>执行<code>ssh localhost</code>即可解决</p>
<p><strong>原因：</strong></p>
<p>.ssh 是记录密码信息的文件夹，如果没有登录过root的话，就没有 .ssh 文件夹，因此登录 localhost ，并输入密码就会生成了。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/Docker安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Johnny's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/24/Docker安装/" class="post-title-link" itemprop="url">Docker安装</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-24 17:42:07 / 修改时间：17:42:50" itemprop="dateCreated datePublished" datetime="2019-09-24T17:42:07+08:00">2019-09-24</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>### </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnrancher.com/docs/rancher/v2.x/cn/installation/basic-environment-configuration/</span><br></pre></td></tr></table></figure>

<p>###</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 下载18.03 docker版本并安装(本地安装)</span><br><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/edge/Packages/docker-ce-18.03.0.ce-1.el7.centos.x86_64.rpm</span><br><span class="line">yum localinstall docker-ce-18.03.0.ce-1.el7.centos.x86_64.rpm </span><br><span class="line"># 下载18.06.03 docker版本并安装(本地安装)</span><br><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-18.06.3.ce-3.el7.x86_64.rpm</span><br><span class="line">yum localinstall docker-ce-18.06.3.ce-3.el7.x86_64.rpm </span><br><span class="line"># service docker restart</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 安装18.06.3 docker版本并安装(非本地安装)</span><br><span class="line">第一步、安装必要的一些系统工具</span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2 bash-completion</span><br><span class="line">第二步、添加软件源 (阿里云软件源)</span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">第三步、查看yum源中所有的docker版本</span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line">第四步、安装 Docker-CE</span><br><span class="line">yum -y install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 docker-ce-selinux-18.06.3.ce-3.el7</span><br></pre></td></tr></table></figure>

<h3 id="安装17-03-2版本"><a href="#安装17-03-2版本" class="headerlink" title="安装17.03.2版本"></a>安装17.03.2版本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> yum remove docker \</span><br><span class="line">              docker-client \</span><br><span class="line">              docker-client-latest \</span><br><span class="line">              docker-common \</span><br><span class="line">              docker-latest \</span><br><span class="line">              docker-latest-logrotate \</span><br><span class="line">              docker-logrotate \</span><br><span class="line">              docker-selinux \</span><br><span class="line">              docker-engine-selinux \</span><br><span class="line">              docker-engine \</span><br><span class="line">              container*</span><br><span class="line"># 定义安装版本</span><br><span class="line">export docker_version=17.03.2</span><br><span class="line"># step 1: 安装必要的一些系统工具</span><br><span class="line"> yum install -y yum-utils device-mapper-persistent-data lvm2 bash-completion</span><br><span class="line"># Step 2: 添加软件源信息</span><br><span class="line"> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"># Step 3: 更新并安装 Docker-CE</span><br><span class="line"> yum makecache all</span><br><span class="line">version=$(yum list docker-ce.x86_64 --showduplicates | sort -r|grep $&#123;docker_version&#125;|awk &apos;&#123;print $2&#125;&apos;)</span><br><span class="line"> yum -y install --setopt=obsoletes=0 docker-ce-$&#123;version&#125; docker-ce-selinux-$&#123;version&#125;</span><br><span class="line"># 如果已经安装高版本Docker,可进行降级安装(可选)</span><br><span class="line">yum downgrade --setopt=obsoletes=0 -y docker-ce-$&#123;version&#125; docker-ce-selinux-$&#123;version&#125;</span><br><span class="line"></span><br><span class="line"># 设置开机启动</span><br><span class="line"> systemctl enable docker</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/openssl-签发证书/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Johnny's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/24/openssl-签发证书/" class="post-title-link" itemprop="url">openssl 签发证书</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-24 17:37:38 / 修改时间：17:38:21" itemprop="dateCreated datePublished" datetime="2019-09-24T17:37:38+08:00">2019-09-24</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Openssl-创建证书"><a href="#Openssl-创建证书" class="headerlink" title="Openssl 创建证书"></a>Openssl 创建证书</h1><h2 id="创建根证书CA"><a href="#创建根证书CA" class="headerlink" title="创建根证书CA"></a>创建根证书CA</h2><ol>
<li><p>生成根证书的私钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca.key 2048</span><br><span class="line">#genrsa  --产生rsa密钥命令</span><br><span class="line">#-out    ---输出路径</span><br><span class="line">#2048    --密钥的长度位数</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成自签证书，即根证书CA</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -days 3650 -key ca.key -out ca.crt</span><br><span class="line">#new：表示生成一个新证书签署请求</span><br><span class="line">#x509：专用于CA生成自签证书，如果不是自签证书则不需要此项</span><br><span class="line">#key：用到的私钥文件</span><br><span class="line">#days：证书的有效期限，单位是day（天）</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="颁发证书"><a href="#颁发证书" class="headerlink" title="颁发证书"></a>颁发证书</h2><ol>
<li><p>生成私钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out yourname.key  2048</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成证书签署请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -days 3650 -key yourname.key -out yourname.csr</span><br><span class="line"></span><br><span class="line">##subject=/C=CN/ST=SH/L=SH/O=Boqii/OU=IT/CN=yourname/emailAddress=***@***.com#</span><br></pre></td></tr></table></figure>
</li>
<li><p>在根证书上，颁发证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -in yourname.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out yourname.crt</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="格式转换"><a href="#格式转换" class="headerlink" title="格式转换"></a>格式转换</h2><ul>
<li><p>格式转换为pfx格式的私钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -export -out yourname.pfx -inkey yourname.key -in yourname.crt</span><br></pre></td></tr></table></figure>
</li>
<li><p>格式转换为cer格式的公钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -inform pem -in yourname.crt -outform der -out yourname.cer</span><br></pre></td></tr></table></figure>

</li>
</ul>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/Docker安装Seafile、Onlyoffice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Johnny's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/24/Docker安装Seafile、Onlyoffice/" class="post-title-link" itemprop="url">Docker安装Seafile、Onlyoffice</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-24 17:00:32 / 修改时间：17:19:54" itemprop="dateCreated datePublished" datetime="2019-09-24T17:00:32+08:00">2019-09-24</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="docker安装Seafile、Onlyoffice"><a href="#docker安装Seafile、Onlyoffice" class="headerlink" title="docker安装Seafile、Onlyoffice"></a>docker安装Seafile、Onlyoffice</h1><p>环境：CentOS 7.6    Docker18.06.3-ce已安装</p>
<ul>
<li><p>安装docker-compose</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.23.0-rc3/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建需要的目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /seafile/data</span><br><span class="line">mkdir -p /seafile/db</span><br><span class="line">mkdir -p /seafile/db/db-backup</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="安装Seafile-6-3-4"><a href="#安装Seafile-6-3-4" class="headerlink" title="安装Seafile 6.3.4"></a>安装Seafile 6.3.4</h2><ul>
<li><p>创建docker-compose.yml文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">  cd /seafile</span><br><span class="line">  vi docker-compose.yml</span><br><span class="line">---输入以下内容---</span><br><span class="line">      version: &apos;2.0&apos;</span><br><span class="line">      services:</span><br><span class="line">        memcached:</span><br><span class="line">          image: memcached:1.5.6</span><br><span class="line">          container_name: seafile-memcached</span><br><span class="line">          restart: always</span><br><span class="line">          entrypoint: memcached -m 256</span><br><span class="line">          networks:</span><br><span class="line">            - seafile-net</span><br><span class="line"></span><br><span class="line">        seafile:</span><br><span class="line">          image: seafileltd/seafile:latest</span><br><span class="line">          container_name: seafile</span><br><span class="line">          restart: always</span><br><span class="line">          ports:</span><br><span class="line">            - &quot;80:80&quot;</span><br><span class="line">      #     - &quot;443:443&quot;  # If https is enabled, cancel the comment.</span><br><span class="line">          volumes:</span><br><span class="line">            - /seafile/data:/shared   # Requested, specifies the path to Seafile data persistent store.</span><br><span class="line">          environment:</span><br><span class="line">            - DB_HOST=db</span><br><span class="line">            - DB_ROOT_PASSWD=boqii399  # Requested, the value shuold be root&apos;s password of MySQL service.</span><br><span class="line">      #      - TIME_ZONE=Asia/Shanghai # Optional, default is UTC. Should be uncomment and set to your local time zone.</span><br><span class="line">            - SEAFILE_ADMIN_EMAIL=johnny@boqii.com # Specifies Seafile admin user, default is &apos;me@example.com&apos;.</span><br><span class="line">            - SEAFILE_ADMIN_PASSWORD=boqii399     # Specifies Seafile admin password, default is &apos;asecret&apos;.</span><br><span class="line">            - SEAFILE_SERVER_LETSENCRYPT=false   # Whether to use https or not.</span><br><span class="line">            - SEAFILE_SERVER_HOSTNAME=172.16.54.254  # Specifies your host name if https is enabled.</span><br><span class="line">          depends_on:</span><br><span class="line">            - memcached</span><br><span class="line">          networks:</span><br><span class="line">            - seafile-net</span><br><span class="line"></span><br><span class="line">      networks:</span><br><span class="line">        seafile-net:</span><br><span class="line">------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Seafile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose.yml up -d</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="安装Seafile7系列版本"><a href="#安装Seafile7系列版本" class="headerlink" title="安装Seafile7系列版本"></a>安装Seafile7系列版本</h2><ul>
<li><p>创建docker-compose.yml文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">  cd  /seafile</span><br><span class="line">  vi docker-compose.yml</span><br><span class="line">---  输入以下内容---</span><br><span class="line">      version: &apos;2.0&apos;</span><br><span class="line">      services:</span><br><span class="line">        db:</span><br><span class="line">          image: mariadb:10.1</span><br><span class="line">          container_name: seafile-mysql</span><br><span class="line">          restart: always</span><br><span class="line">          environment:</span><br><span class="line">            - MYSQL_ROOT_PASSWORD=boqii399  # Requested, set the root&apos;s password of MySQL service.</span><br><span class="line">            - MYSQL_LOG_CONSOLE=true</span><br><span class="line">          volumes:</span><br><span class="line">            - /seafile/db:/var/lib/mysql  # Requested, specifies the path to MySQL data persistent store.</span><br><span class="line">          networks:</span><br><span class="line">            - seafile-net</span><br><span class="line"></span><br><span class="line">        memcached:</span><br><span class="line">          image: memcached:1.5.6</span><br><span class="line">          container_name: seafile-memcached</span><br><span class="line">          restart: always</span><br><span class="line">          entrypoint: memcached -m 256</span><br><span class="line">          networks:</span><br><span class="line">            - seafile-net</span><br><span class="line"></span><br><span class="line">        seafile:</span><br><span class="line">          image: seafileltd/seafile-mc:latest</span><br><span class="line">          container_name: seafile</span><br><span class="line">          restart: always</span><br><span class="line">          ports:</span><br><span class="line">            - &quot;80:80&quot;</span><br><span class="line">      #     - &quot;443:443&quot;  # If https is enabled, cancel the comment.</span><br><span class="line">          volumes:</span><br><span class="line">            - /seafile/data:/shared   # Requested, specifies the path to Seafile data persistent store.</span><br><span class="line">          environment:</span><br><span class="line">            - DB_HOST=db</span><br><span class="line">            - DB_ROOT_PASSWD=boqii399  # Requested, the value shuold be root&apos;s password of MySQL service.</span><br><span class="line">      #      - TIME_ZONE=Asia/Shanghai # Optional, default is UTC. Should be uncomment and set to your local time zone.</span><br><span class="line">            - SEAFILE_ADMIN_EMAIL=johnny@boqii.com # Specifies Seafile admin user, default is &apos;me@example.com&apos;.</span><br><span class="line">            - SEAFILE_ADMIN_PASSWORD=boqii399     # Specifies Seafile admin password, default is &apos;asecret&apos;.</span><br><span class="line">            - SEAFILE_SERVER_LETSENCRYPT=false   # Whether to use https or not.</span><br><span class="line">            - SEAFILE_SERVER_HOSTNAME=172.16.54.254 # Specifies your host name if https is enabled.</span><br><span class="line">          depends_on:</span><br><span class="line">            - db</span><br><span class="line">            - memcached</span><br><span class="line">          networks:</span><br><span class="line">            - seafile-net</span><br><span class="line"></span><br><span class="line">      networks:</span><br><span class="line">        seafile-net:</span><br><span class="line">--------------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Seafile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose.yml up -d</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="安装onlyoffice"><a href="#安装onlyoffice" class="headerlink" title="安装onlyoffice"></a>安装onlyoffice</h2><ul>
<li><p>创建需要的目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/onlyoffice</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建docker-compose.yaml文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">  cd  /data/onlyoffice</span><br><span class="line">  vi docker-compose.yml</span><br><span class="line">---  输入以下内容---</span><br><span class="line">      version: &apos;2.0&apos;</span><br><span class="line">      services:</span><br><span class="line">        onlyoffice-documentserver:</span><br><span class="line">          container_name: onlyoffice</span><br><span class="line">          restart: always</span><br><span class="line">          image: onlyoffice/documentserver:latest</span><br><span class="line">      #    environment:</span><br><span class="line">      #      - AMQP_SERVER_URL=amqp://guest:guest@onlyoffice-activemq</span><br><span class="line">      #      - AMQP_SERVER_TYPE=activemq</span><br><span class="line">      #    stdin_open: true</span><br><span class="line">          ports:</span><br><span class="line">            - &apos;8001:80&apos;</span><br><span class="line">      #      - &apos;443:443&apos;</span><br><span class="line">      #    networks:</span><br><span class="line">      #     - onlyoffice</span><br><span class="line"></span><br><span class="line">      #  onlyoffice-activemq:</span><br><span class="line">      #    container_name: onlyoffice-activemq</span><br><span class="line">      #    image: webcenter/activemq:5.14.3</span><br><span class="line">      #    environment:</span><br><span class="line">      #      - ACTIVEMQ_USERS_guest=guest</span><br><span class="line">      #      - ACTIVEMQ_GROUPS_owners=guest</span><br><span class="line">      #    restart: always</span><br><span class="line">      #    networks:</span><br><span class="line">      #     - onlyoffice</span><br><span class="line">      #    expose:</span><br><span class="line">      #      - &apos;5672&apos;</span><br><span class="line"></span><br><span class="line">      networks:</span><br><span class="line">        onlyoffice:</span><br><span class="line">      #    driver: &apos;bridge&apos;</span><br><span class="line">--------------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装onlyoffice<br><code>docker-compose -f docker-compose.yml up -d</code></p>
</li>
<li><p>启动容器<br><code>docker start &lt;容器名&gt;</code></p>
</li>
<li><p>开机自启动容器<br><code>docker update --restart=always &lt;容器名&gt;</code><br>seafile系统配置</p>
</li>
</ul>
<h2 id="备份seafile数据"><a href="#备份seafile数据" class="headerlink" title="备份seafile数据"></a>备份seafile数据</h2><h3 id="Seafile-6-3-4"><a href="#Seafile-6-3-4" class="headerlink" title="Seafile 6.3.4"></a>Seafile 6.3.4</h3><ul>
<li><p>数据库备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  cd /seafile/db/db-backup</span><br><span class="line">      docker exec -ti seafile mysqldump  -uroot  --opt ccnet_db &gt; ccnet_db.sql.$(date +&quot;%F&quot;)</span><br><span class="line">      docker exec -ti seafile mysqldump  -uroot --opt seafile_db &gt; seafile_db.sql.$(date +&quot;%F&quot;)</span><br><span class="line">      docker exec -ti seafile mysqldump  -uroot  --opt seahub_db &gt; seahub_db.sql.$(date +&quot;%F&quot;)</span><br><span class="line">---  脚本---</span><br><span class="line">      #!/bin/bash</span><br><span class="line"></span><br><span class="line">      cd /seafile/db/db-backup</span><br><span class="line"></span><br><span class="line">      for i in ccnet_db seafile_db seahub_db</span><br><span class="line">      do</span><br><span class="line">       docker exec -ti seafile mysqldump -uroot --opt $i &gt; $i.sql.$(date +&quot;%F&quot;)</span><br><span class="line">      done</span><br><span class="line"></span><br><span class="line">      # 清理30天前</span><br><span class="line">      find . -name &quot;*sql*&quot; -mtime +30 -delete</span><br><span class="line">------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据备份<br><code>rsync -avh --progress /seafile  目标目录(备份目录)</code></p>
</li>
<li><p>数据恢复</p>
<ul>
<li>数据库恢复<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /seafile/db/db-backup</span><br><span class="line">docker exec -ti seafile bash</span><br><span class="line">mysql ccnet_db &lt; ccnet_db.sql.日期</span><br><span class="line">mysql seafile_db &lt; seafile_db.sql.日期</span><br><span class="line">mysql seahub_db &lt; seahub_db.sql.日期</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>数据文件恢复<br><code>rsync -avh --progress 备份目录 /seafile</code></p>
</li>
</ul>
<h3 id="Seafile-7版本系列"><a href="#Seafile-7版本系列" class="headerlink" title="Seafile 7版本系列"></a>Seafile 7版本系列</h3><ul>
<li><p>数据库备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  cd /seafile/db/db-backup</span><br><span class="line">      docker exec -ti seafile-mysql mysqldump  -uroot -pboqii399 --opt ccnet_db &gt; ccnet_db.sql.$(date +&quot;%F&quot;)</span><br><span class="line">      docker exec -ti seafile-mysql mysqldump  -uroot -pboqii399 --opt seafile_db &gt; seafile_db.sql.$(date +&quot;%F&quot;)</span><br><span class="line">      docker exec -ti seafile-mysql mysqldump  -uroot -pboqii399 --opt seahub_db &gt; seahub_db.sql.$(date +&quot;%F&quot;)</span><br><span class="line">---  脚本---</span><br><span class="line">      #!/bin/bash</span><br><span class="line"></span><br><span class="line">      cd /seafile/db/db-backup</span><br><span class="line"></span><br><span class="line">      for i in ccnet_db seafile_db seahub_db</span><br><span class="line">      do</span><br><span class="line">       docker exec -ti seafile-mysql mysqldump -uroot --opt $i &gt; $i.sql.$(date +&quot;%F&quot;)</span><br><span class="line">      done</span><br><span class="line"></span><br><span class="line">      # 清理30天前</span><br><span class="line">      find . -name &quot;*sql*&quot; -mtime +30 -delete</span><br><span class="line">------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据备份<br><code>rsync -avh --progress /seafile  目标目录(备份目录)</code></p>
</li>
<li><p>数据恢复</p>
<ul>
<li><p>数据库恢复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#方法1：</span><br><span class="line">docker exec -ti seafile-mysql /bin/sh -c &quot; mysql -uroot -pboqii399 ccnet_db &lt; /var/lib/mysql/db-back/ccnet_db.sql.2019-07-25&quot;</span><br><span class="line">#方法2：     </span><br><span class="line">docker exec -ti seafile-mysql  bash</span><br><span class="line">mysql -uroot -pboqii399 seafile_db &lt; /var/lib/mysql/db-back/seafile_db.sql.2019-07-25</span><br><span class="line">mysql -uroot -pboqii399 seahub_db &lt; /var/lib/mysql/db-back/seahub_db.sql.2019-07-25</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据文件恢复<br><code>rsync -avh --progress 备份目录 /seafile</code></p>
</li>
</ul>
</li>
</ul>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/23/搭建hexo博客系统/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Johnny's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/23/搭建hexo博客系统/" class="post-title-link" itemprop="url">搭建hexo博客系统</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-23 09:37:06" itemprop="dateCreated datePublished" datetime="2019-09-23T09:37:06+08:00">2019-09-23</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-24 16:40:44" itemprop="dateModified" datetime="2019-09-24T16:40:44+08:00">2019-09-24</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>环境：已注册Github,并将本机的SSH Key成功上传</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>1、 rpm安装nodejs npm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://rpm.nodesource.com/setup_10.x | bash -</span><br><span class="line">yum install -y nodejs</span><br></pre></td></tr></table></figure>

<p>2、 安装hexo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo</span><br></pre></td></tr></table></figure>

<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>1、初始化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /data</span><br><span class="line">hexo init blog</span><br></pre></td></tr></table></figure>

<p>2、框架安装<br><code>npm install</code><br>3、安装Hexo启动服务器的插件<br><code>npm install hexo-server --save</code><br>4、启动服务器  本地查看效果，若不指定端口，默认为4000<br><code>hexo server</code></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>1、Github创建仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建的仓库名称必须是***.github.io</span><br><span class="line">在仓库的settings中，勾选Template repository</span><br></pre></td></tr></table></figure>

<p>2、安装hexo的git组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>3、添加git配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /data/blog/</span><br><span class="line">vi _config.yml</span><br><span class="line">------添加如下内容------</span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: git@github.com:*/*.github.io.git #如git@github.com:johnnywl/johnnywl.github.io.git</span><br><span class="line">  branch: master</span><br><span class="line">------------------------</span><br></pre></td></tr></table></figure>

<p>4、查看是否可提交代码至github仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T -ai ~/.ssh/id_rsa git@github.com</span><br></pre></td></tr></table></figure>

<h2 id="创建博客"><a href="#创建博客" class="headerlink" title="创建博客"></a>创建博客</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo new &apos;博客名称&apos;</span><br><span class="line">vi /data/blog/source/_posts/&apos;博客名称.md&apos;</span><br></pre></td></tr></table></figure>

<h2 id="部署hexo"><a href="#部署hexo" class="headerlink" title="部署hexo"></a>部署hexo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo d</span><br><span class="line">----或者----</span><br><span class="line">hexo d -g</span><br><span class="line">------------</span><br></pre></td></tr></table></figure>

<h2 id="hexo优化"><a href="#hexo优化" class="headerlink" title="hexo优化"></a>hexo优化</h2><ul>
<li><p>下载主题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /data/tools</span><br><span class="line">wget https://github.com/theme-next/hexo-theme-next/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line">mv hexo-theme-next-master /data/blog/themes/hexo-theme-next</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改_config.yml 中的主题属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">title: Johnnywl&apos;s Blog</span><br><span class="line">theme: hexo-theme-next</span><br></pre></td></tr></table></figure>
</li>
<li><p>hexo-theme-next首页文字显示预览</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /data/blog/themes/hexo-theme-next</span><br><span class="line">vi _config.yml</span><br><span class="line">---修改如下内容---</span><br><span class="line">auto_excerpt:</span><br><span class="line">  enable: false   # false修改为true </span><br><span class="line">------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>hexo-theme-next添加搜索功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br><span class="line">vi /data/blog/_config.yml</span><br><span class="line">---添加如下内容---</span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br><span class="line">------------------</span><br><span class="line">vi /data/blog/themes/hexo-theme-next/_config.yml</span><br><span class="line">---修改如下内容---</span><br><span class="line">local_search:</span><br><span class="line">  enable: false    # false修改为true</span><br><span class="line">------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>Mist字体的段落间距过大</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vi /data/blog/themes/hexo-theme-next-master/source/css/_schemes/Mist/_posts-expand.styl</span><br><span class="line">---修改如下内容---</span><br><span class="line">  article &#123;</span><br><span class="line">    margin-top: 120px;   #修改此项，可改变段落间距</span><br><span class="line"></span><br><span class="line">    &amp;:first-child &#123;</span><br><span class="line">      margin-top: 0;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">------------------</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加网格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vi /data/blog/themes/hexo-theme-next-master/layout/_layout.swig</span><br><span class="line">---添加如下内容 ---  # 以下代码添加在&lt;/body&gt;前（不能放在&lt;/head&gt;的后面）</span><br><span class="line">&#123;% if thmem.canvas_nest %&#125;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js&quot;&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&#123;% ednif %&#125;</span><br><span class="line">-----------------</span><br><span class="line">vi /data/blog/themes/hexo-theme-next/_config.yml</span><br><span class="line">---修改如下内容---</span><br><span class="line">canvas_nest：true</span><br><span class="line">color:线条颜色，默认：&apos;0,0,0&apos;,三个数字分别为（R,G,B）</span><br><span class="line">opacity:线条透明度（0~1），默认：0.5</span><br><span class="line">count:线条的总数量，默认：150</span><br><span class="line">zIndex:背景的z-index属性，css属性用于控制所在层的位置，默认：-1</span><br><span class="line">------------------</span><br></pre></td></tr></table></figure>

</li>
</ul>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </div>

  


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
  </nav>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John</span>
</div>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/muse.js?v=7.4.0"></script>

<script src="/js/next-boot.js?v=7.4.0"></script>



  








  <script src="/js/local-search.js?v=7.4.0"></script>














  

  

  

  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  
</body>
</html>
